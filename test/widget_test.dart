import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:weather_insights_app/main.dart';

void main() {
  testWidgets('Weather app loads with welcome screen', (WidgetTester tester) async {
    // Lance l'app avec un th√®me par d√©faut
    await tester.pumpWidget(const MyApp(initialThemeMode: ThemeMode.light));
    
    // V√©rifie que le titre de l'app est pr√©sent
    expect(find.text('üå§Ô∏è Weather Insights'), findsOneWidget);
    
    // V√©rifie le message de bienvenue
    expect(find.text('Welcome! Enter a city to get weather insights.'), findsOneWidget);
    
    // V√©rifie que le champ de recherche existe
    expect(find.byType(TextField), findsOneWidget);
  });

  testWidgets('Search field accepts input', (WidgetTester tester) async {
    await tester.pumpWidget(const MyApp(initialThemeMode: ThemeMode.light));
    
    // Trouve le TextField
    final textField = find.byType(TextField);
    expect(textField, findsOneWidget);
    
    // Entre du texte
    await tester.enterText(textField, 'Abidjan');
    await tester.pump();
    
    // V√©rifie que le texte est entr√©
    expect(find.text('Abidjan'), findsOneWidget);
    
    // V√©rifie que le bouton clear appara√Æt
    expect(find.byIcon(Icons.clear), findsOneWidget);
  });

  testWidgets('Clear button clears the text field', (WidgetTester tester) async {
    await tester.pumpWidget(const MyApp(initialThemeMode: ThemeMode.light));
    
    // Entre du texte
    await tester.enterText(find.byType(TextField), 'Paris');
    await tester.pump();
    
    // Appuie sur le bouton clear
    await tester.tap(find.byIcon(Icons.clear));
    await tester.pump();
    
    // V√©rifie que le texte est effac√©
    expect(find.text('Paris'), findsNothing);
  });

  testWidgets('Theme switcher toggles between light and dark mode', (WidgetTester tester) async {
    await tester.pumpWidget(const MyApp(initialThemeMode: ThemeMode.light));
    
    // V√©rifie que l'ic√¥ne dark_mode est pr√©sente (mode light actif)
    expect(find.byIcon(Icons.dark_mode), findsOneWidget);
    
    // Tap sur le bouton de th√®me
    await tester.tap(find.byIcon(Icons.dark_mode));
    await tester.pumpAndSettle();
    
    // V√©rifie que l'ic√¥ne a chang√© pour light_mode (mode dark actif)
    expect(find.byIcon(Icons.light_mode), findsOneWidget);
  });
}